#!/bin/sh

# check root
if [ "$EUID" -ne 0 ]; then
    echo "please run as root"
    exit;
fi

alias ls=ls
scriptResult=`hostname`.txt

echo '######################################################' >> $scriptResult 2>&1
echo '##### Linux Check script Ver. "0.1" by "0xe82de" #####' >> $scriptResult 2>&1
echo '######################################################' >> $scriptResult 2>&1
echo >> $scriptResult 2>&1

echo '######################################################' >> $scriptResult 2>&1
echo '##### Start Time' >> $scriptResult 2>&1
date >> $scriptResult 2>&1
echo >> $scriptResult 2>&1

echo '######################################################' >> $scriptResult 2>&1
echo '##### System Info' >> $scriptResult 2>&1
echo '##### OS :  `cat /etc/system-release`' >> $scriptResult 2>&1
echo '##### HOST : `uname -n`' >> $scriptResult 2>&1
echo '##### KERNEL : `uname -r`' >> $scriptResult 2>&1
echo >> $scriptResult 2>&1

echo '######################################################' >> $scriptResult 2>&1
echo '##### Network Info' >> $scriptResult 2>&1
ifconfig -a >> $scriptResult 2>&1
echo >> $scriptResult 2>&1

echo '##################################################' >> $scriptResult
echo '##### U-01' >> $scriptResult
echo '##### 양호 : 원격 터미널 서비스를 사용하지 않거나, 사용 시 root 직접 접속을 차단한 경우' >> $scriptResult
echo '##### telnet : pts 터미널이 설정되어 있지 않고 remote 파일에 pam_securetty.so 설정이 있는 경우' >> $scriptResult
echo '##### ssh : /etc/ssh/sshd_config PermitRootLogin no' >> $scriptResult
echo '##### 취약 : 원격 터미널 사용 시 root 직접 접속을 허용한 경우' >> $scriptResult
echo '##### telnet : pts 터미널이 설정되어 있거나 remote 파일에 pam_securetty.so 설정이 없는 경우 ' >> $scriptResult
echo '##### ssh : /etc/ssh/sshd_config PermitRootLogin yes or 주석' >> $scriptResult
echo >> $scriptResult

echo '##### telnet' >> $scriptResult
grep pts /etc/securetty >> $scriptResult
echo >> $scriptResult
grep 'pam_securetty.so' /etc/pam.d/remote >> $scriptResult
echo >> $scriptResult

echo '##### ssh' >> $scriptResult
grep 'PermitRootLogin' /etc/ssh/sshd_config | grep -v 'setting' >> $scriptResult
echo >> $scriptResult

echo '######################################################' >> $scriptResult 2>&1
echo '##### End Time' >> $scriptResult 2>&1
date >> $scriptResult 2>&1
echo >> $scriptResult 2>&1

echo '#######################################' >> $scriptResult 2>&1
echo '##### Linux Check script Finished #####' >> $scriptResult 2>&1
echo '#######################################' >> $scriptResult 2>&1