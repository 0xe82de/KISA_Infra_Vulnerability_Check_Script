@echo off

REM On Windows 10, the script below can be successful without administrator privileges.
REM In other words, it is inappropriate to verify that the batch file was run with administrator privileges.
REM >nul 2>&1 "%SYSTEMROOT%\system32\cacls.exe" "%SYSTEMROOT%\system32\config\system"

REM Use the bcddit command to verify that administrator privileges are executed.
>nul 2>&1 bcdedit
if '%errorlevel%' NEQ '0' (
  echo "Execute Admin Priv"
  goto GetAdmin
) else ( goto GotAdmin )
:GetAdmin
  echo Set UAC = CreateObject^("Shell.Application"^) > "%temp%\getAdmin.vbs"
  set params = %*:"=""
  echo UAC.ShellExecute "cmd.exe", "/c %~s0 %params%", "", "runas", 1 >> "%temp%\getAdmin.vbs"
  "%temp%\getAdmin.vbs"
  del "%temp%\getAdmin.vbs"
  exit /B
:GotAdmin

pushd "%CD%"
  CD /D "%~dp0"

setlocal
chcp 949

set "scriptResult=.\%COMPUTERNAME%.txt"

echo ################################################################# >> %scriptResult%
echo ##### Windows PC 64bit Check script Ver. "0.1" by "0xe82de" ##### >> %scriptResult%
echo ################################################################# >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### start time >> %scriptResult%
date /t >> %scriptResult%
time /t >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### ipconfig /all >> %scriptResult%
ipconfig /all >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### netstat -an >> %scriptResult%
c:\windows\system32\netstat -an >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### systeminfo >> %scriptResult%
systeminfo >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-01 >> %scriptResult%
echo ##### 양호 : 최대 암호 사용 기간이 "90일" 이하로 설정되어 있는 경우 >> %scriptResult%
echo ##### MaximumPasswordAge ^<= 90 >> %scriptResult%
echo ##### 취약 : 암호 사용 기간이 "제한" 없음이거나 "90일"을 초과하여 설정되어 있는 경우 >> %scriptResult%
echo ##### MaximumPasswordAge ^> 90 or -1 >> %scriptResult%
echo. >>%scriptResult%

secedit /EXPORT /CFG SEC.txt
type SEC.txt | find /i "MaximumPasswordAge =" >> %scriptResult%
echo. >> %scriptResult%

echo 고려사항 : 최근 암호기억(24개), 최소 암호 사용기간(1일) >> %scriptResult%
type SEC.txt | find /i "PasswordHistorySize =" >> %scriptResult%
type SEC.txt | find /i "MinimumPasswordAge =" >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-02 >> %scriptResult%
echo ##### 양호 : 최소 암호 길이가 해당 기관의 보안 정책을 반영하여 설정되어 있는 경우 >> %scriptResult%
echo ##### MinimumPasswordLength ^>= 8 >> %scriptResult%
echo ##### 취약 : 암호를 사용하지 않거나, 추측하기 쉬운 문자조합으로 이루어진 짧은 자릿수의 패스워드를 사용하는 경우 >> %scriptResult%
echo ##### MinimumPassworLength ^< 8 >> %scriptResult%
echo. >> %scriptResult%

type SEC.txt | find /i "MinimumPasswordLength =" >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-03 >> %scriptResult%
echo ##### 양호 : 불필요한 공유 폴더가 존재하지 않거나 공유 폴더에 접근권한 및 암호가 설정되어있는 경우 >> %scriptResult%
echo ##### No results "net share" command >> %scriptResult%
echo ##### AutoShareServer    REG_DWORD    0x0 >> %scriptResult%
echo ##### AutoShareWks    REG_DWORD    0x0 >> %scriptResult%
echo ##### 일반 공유 폴더 권한 everyone 존재 >> %scriptResult%
echo ##### 취약 : 불필요한 공유 폴더가 존재하거나 접근권한 및 암호 설정 없이 공유폴더를 사용하는 경우 >> %scriptResult%
echo ##### C$, etc, ... exist >> %scriptResult%
echo ##### AutoShareServer    REG_DWORD    !(0x0) or Non exist >> %scriptResult%
echo ##### AutoShareWks    REG_DWORD    !(0x0) or Non exist >> %scriptResult%
echo ##### 일반 공유 폴더 권한 everyone 존재 >> %scriptResult%
echo. >> %scriptResult%

echo ##### net share >> %scriptResult%
net share | find "$" | findstr /V /i "IPC print" >> %scriptResult%
echo. >> %scriptResult%

echo ##### registry >> %scriptResult%
reg query "HKLM\System\CurrentControlSet\Services\LanmanServer\Parameters" | find /i "AutoShareServer" >> %scriptResult%
reg query "HKLM\System\CurrentControlSet\Services\LanmanServer\Parameters" | find /i "AutoShareWks" >> %scriptResult%
echo. >> %scriptResult%

echo ##### normal sharedfolder >> %scriptResult%
net share | find "\" | find /V "$" >> sharedFolder.txt
for /f "tokens=1" %%j IN (sharedFolder.txt) DO net share %%j >> %scriptResult%
del sharedFolder.txt
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-04 >> %scriptResult%
echo ##### 양호 : 일반적으로 불필요한 서비스(아래 목록 참조)가 중지되어 있는 경우 >> %scriptResult%
echo ##### 취약 : 일반적으로 불필요한 서비스(아래 목촉 참조)가 구동 중인 경우 >> %scriptResult%
echo ##### Alerter >> %scriptResult%
echo ##### Automatic Updates >> %scriptResult%
echo ##### Clipbook >> %scriptResult%
echo ##### Computer Browser >> %scriptResult%
echo ##### Cryptographic Services >> %scriptResult%
echo ##### DHCP Client >> %scriptResult%
echo ##### Distributed Link Tracking Client Server >> %scriptResult%
echo ##### DNS Client >> %scriptResult%
echo ##### Error reporting Service >> %scriptResult%
echo ##### Human Interface Device Access >> %scriptResult%
echo ##### IMAPI CD-Burning COM Service >> %scriptResult%
echo ##### Infrared Monitor >> %scriptResult%
echo ##### Messenger >> %scriptResult%
echo ##### NetMeeting Remote Desktop Sharing >> %scriptResult%
echo ##### Portable Media >> %scriptResult%
echo ##### Serial Number >> %scriptResult%
echo ##### Print Spooler >> %scriptResult%
echo ##### Remote Registry >> %scriptResult%
echo ##### Simple TCP/IP Services >> %scriptResult%
echo ##### Universal Plug and Play Device Host >> %scriptResult%
echo ##### Wireless Zero Configuration >> %scriptResult%
echo. >> %scriptResult%

net start >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-05 >> %scriptResult%
echo ##### 양호 : Windows Messenger가 실행 중지된 상태이거나 상용 메신저가 설치되지 않은 경우 >> %scriptResult%
echo ##### PreventRun    REG_DWORD    0x1 >> %scriptResult%
echo ##### 상용 메신저 미설치(카카오톡 등) >> %scriptResult%
echo ##### 취약 : Windows Messenger가 실행 중이거나 상용 메신저가 설치되어 있는 경우 >> %scriptResult%
echo ##### PreventRun    REG_DWORD    0x0 >> %scriptResult%
echo ##### 상용 메신저 설치(카카오톡 등) >> %scriptResult%
echo. >> %scriptResult%

echo ##### registry >> %scriptResult%
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Messenger\Client" | find /i "PreventRun" >> %scriptResult%
echo. >> %scriptResult%

echo ##### 상용 메신저 >> %scriptResult%
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall" | find /i "KakaoTalk" >> %scriptResult%
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Windows\CurrentVersion\Uninstall" | find /i "KakaoTalk" >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-06 >> %scriptResult%
echo ##### 양호 : HOT FIX 설치 및 자동 업데이트 설정이 되어 있고 내부적으로 관리 절차를 수립하여 이행하고 있는 경우 >> %scriptResult%
echo ##### 내부적으로 관리 절차가 있을 경우 or 핫픽스가 최신일 경우 >> %scriptResult%
echo ##### 취약 : HOT FIX가 설치되어 있지 않거나 내부적으로 관리 절차가 수립되어 있지 않은 경우 >> %scriptResult%
echo ##### 내부적으로 관리 절차가 없고 핫픽스가 최신이 아닐 경우 >> %scriptResult%
echo. >> %scriptResult%

wmic qfe get HotFixID, InstalledOn >> hotfix.txt
type hotfix.txt >> %scriptResult%
del hotfix.txt
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-07 >> %scriptResult%
echo ##### Windows 10 해당없음 >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-08 >> %scriptResult%
echo ##### 양호 : 설치된 응용 프로그램의 최신 패치가 적용되어 있고 내부적으로 관리 절차를 수립하여 이행하고 있는 경우 >> %scriptResult%
echo ##### 내부적으로 관리 절차가 있을 경우 or 패치버전이 최신일 경우 >> %scriptResult%
echo ##### 취약 : 설치된 응용 프로그램의 최신 패치가 적용되어 있지 않거나 내부적으로 관리 절차가 수립되어 있지 않은 경우 >> %scriptResult%
echo ##### 내부적으로 관리 절차가 없고 패치버전이 최신이 아닐 경우 >> %scriptResult%
echo. >> %scriptResult%

echo ##### MS-Office >> %scriptResult%
echo 기업용 MS-Office의 경우 윈도우 업데이트 시 자동으로 업데이트 >> %scriptResult%
echo. >> %scriptResult%

echo ##### 한글 >> %scriptResult%
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\HNC\Shared\HncUpdate" | find "LastUpdate" >> %scriptResult%
echo. >> %scriptResult%

echo ##### Adobe >> %scriptResult%
echo ##### Acrobat Reader >> %scriptResult%
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Adobe\Acrobat Reader" /s | FIND /I "installdate" >> %scriptResult%
echo ##### Adobe Acrobat >> %scriptResult%
reg query "HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Adobe\Adobe Acrobat" /s | FIND /I "installdate" >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-09 >> %scriptResult%
echo ##### 양호 : 백신이 설치되어 있고, 최신 업데이트가 적용 되어 있는 경우 >> %scriptResult%
echo ##### V3 Lite : AscVersion    REG_SZ    2020.08.03.01 >> %scriptResult%
echo ##### 취약 : 백신이 설치되어 있지 않거나, 최신 업데이트가 적용 되어 있지 않은 경우 >> %scriptResult%
echo ##### Non exist >> %scriptResult%
echo. >> %scriptResult%

reg query "HKLM\SOFTWARE\Ahnlab" /s | find "AscVersion" >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-10 >> %scriptResult%
echo ##### 양호 : 설치된 백신의 실시간 감시 기능이 활성화 되어 있는 경우 >> %scriptResult%
echo ##### V3 Lite : AvMon    REG_DWORD    0x1 >> %scriptResult%
echo ##### 취약 : 백신이 설치되어 있지 않거나, 실시간 감시 기능이 비활성화 되어 있는 경우 >> %scriptResult%
echo ##### V3 Lite : AvMon    REG_DWORD    0x0 or Non exist >> %scriptResult%
echo. >> %scriptResult%

reg query "HKLM\SOFTWARE\Ahnlab" /s | find "AvMon" >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-11 >> %scriptResult%
echo ##### 양호 : Windows 방화벽 "사용"으로 설정되어 있는 경우 또는 유·무료 기타 방화벽을 사용하고 있는 경우 >> %scriptResult%
echo ##### EnableFirewall    REG_DWORD    0x1 or 다른 방화벽 사용 >> %scriptResult%
echo ##### 취약 : Windows 방화벽 "사용 안 함"으로 설정되어 있는 경우 또는 유·무료 기타 방화벽을 사용하고 있지 않는 경우 >> %scriptResult%
echo ##### EnableFirewall    REG_DWORD    0x0 or 다른 방화벽 미사용>> %scriptResult%
echo. >> %scriptResult%

reg query "HKLM\SYSTEM\CurrentControlSet\Services\SharedAccess\Parameters\FirewallPolicy\StandardProfile" | find /I "EnableFirewall" >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-12 >> %scriptResult%
echo ##### 양호 : 화면보호기 설정(대기시간 10분 이하) 및 암호로 보호가 설정되어 있는 경우 >> %scriptResult%
echo ##### ScreenSaveActive    REG_SZ    1 >> %scriptResult%
echo ##### ScreenSaveTimeOut    REG_SZ    600 이하 >> %scriptResult%
echo ##### ScreenSaverIsSecure    REG_SZ    1 >> %scriptResult%
echo ##### 취약 : 화면보호기 설정(대기시간 10분 초과) 및 암호로 설정되어 있지 않은 경우 >> %scriptResult%
echo ##### ScreenSaveActive    REG_SZ    9 >> %scriptResult%
echo ##### ScreenSaveTimeOut    REG_SZ    600 초과 >> %scriptResult%
echo ##### ScreenSaverIsSecure    REG_SZ    0 >> %scriptResult%
echo. >> %scriptResult%

reg query "HKCU\Control Panel\Desktop" | find /I "ScreenSaveActive" >> %scriptResult%
reg query "HKCU\Control Panel\Desktop" | find /I "ScreenSaveTimeOut" >> %scriptResult%
reg query "HKCU\Control Panel\Desktop" | find /I "ScreenSaverIsSecure" >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-13 >> %scriptResult%
echo ##### 양호 : 미디어 사용 시 자동 실행되지 않고 내부적으로 관리 절차를 수립하여 이행하고 있는 경우 >> %scriptResult%
echo ##### NoDriveTypeAutoRun    REG_DWORD    0xff >> %scriptResult%
echo ##### 취약 : 미디어 사용 시 자동 실행되거나 내부적으로 관리 절차가 수립되어 있지 않은 경우 >> %scriptResult%
echo ##### NoDriveTypeAutoRun    REG_DWORD    0xb5 or Non exist >> %scriptResult%
echo. >> %scriptResult%

reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer" | FIND /I "NoDriveTypeAutoRun" >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-14 >> %scriptResult%
echo ##### 양호 : 설치된 ActiveX를 주기적(매달 1번 권고)으로 점검하고 불필요한 ActiveX를 삭제하는 경우 >> %scriptResult%
echo ##### 취약 : 설치된 ActiveX에 대한 주기적인 점검 및 삭제가 이루어지지 않는 경우 >> %scriptResult%
echo. >> %scriptResult%

dir "%systemroot%\Downloaded Program Files" | find "20">> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-15 >> %scriptResult%
echo ##### 양호 : 복구 콘솔 자동 로그온 허용이 "사용 안 함"으로 설정되어 있는 경우 >> %scriptResult%
echo ##### securitylevel    REG_DWORD    0x0 >> %scriptResult%
echo ##### 취약 : 복구 콘솔 자동 로그온 허용이 "사용"으로 설정되어 있는 경우 >> %scriptResult%
echo ##### securitylevel    REG_DWORD    0x1 >> %scriptResult%
echo. >> %scriptResult%

reg query "HKLM\Software\Microsoft\Windows NT\CurrentVersion\Setup\RecoveryConsole" | find /I "securitylevel" >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-16 >> %scriptResult%
echo ##### 양호 : 모든 디스크 볼륨의 파일 시스템이 NTFS인 경우 >> %scriptResult%
echo #####  >> %scriptResult%
echo ##### 취약 : 모든 디스크 볼륨의 파일 시스템이 FAT32인 경우 >> %scriptResult%
echo #####  >> %scriptResult%
echo. >> %scriptResult%

cacls %SYSTEMROOT%\ | find "OI" >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-17 >> %scriptResult%
echo ##### 양호 : PC 내에 하나의 OS만 설치되어 있는 경우 >> %scriptResult%
echo ##### 취약 : PC 내에 2개 이상의 OS가 설치되어 있는 경우 >> %scriptResult%
echo. >> %scriptResult%

bcdedit >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-18 >> %scriptResult%
echo ##### 양호 : "브라우저를 닫을 때 임시 인터넷 파일 폴더 비우기" 설정이 "사용"으로 설정되어 있는 경우 >> %scriptResult%
echo ##### Persistent    REG_DWORD    0x0 >> %scriptResult%
echo ##### 취약 : "브라우저를 닫을 때 임시 인터넷 파일 폴더 비우기" 설정이 "사용"으로 설정되어 있지 않은 경우 >> %scriptResult%
echo ##### Persistent    REG_DWORD    0x1 or Non exist >> %scriptResult%
echo. >> %scriptResult%

reg query "HKLM\SOFTWARE\Policies\Microsoft\Windows\CurrentVersion\Internet Settings\Cache" | find /I "Persistent" >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-19 >> %scriptResult%
echo ##### 양호 : Windows Messenger 자동시작 금지 설정이 되어있는 경우 >> %scriptResult%
echo ##### PreventAutoRun    REG_DWORD    0x1 >> %scriptResult%
echo ##### 취약 : Windows Messenger 자동시작 금지 설정이 되어있지 않는 경우 >> %scriptResult%
echo ##### PreventAutoRun    REG_DWORD    0x0 or Non exist >> %scriptResult%
echo. >> %scriptResult%

reg query "HKLM\SOFTWARE\Policies\Microsoft\Messenger\Client" | find "PreventAutoRun" >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### PC-20 >> %scriptResult%
echo ##### 양호 : 원격 지원이 "사용 안 함"으로 설정 되어 있는 경우 >> %scriptResult%
echo ##### fAllowUnsolicited    REG_DWORD    0x0 >> %scriptResult%
echo ##### 취약 : 원격 지원이 "사용"으로 설정 되어 있는 경우 >> %scriptResult%
echo ##### fAllowUnsolicited    REG_DWORD    0x1 or Non exist >> %scriptResult%
echo. >> %scriptResult%

reg query "HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services" | find /I "fAllowUnsolicited" >> %scriptResult%
echo. >> %scriptResult%

del SEC.txt

echo ################################################## >> %scriptResult%
echo ##### end time>> %scriptResult%
date /t >> %scriptResult%
time /t >> %scriptResult%
echo. >> %scriptResult%

echo ################################################## >> %scriptResult%
echo ##### Windows PC 64bit Check script Finished ##### >> %scriptResult%
echo ################################################## >> %scriptResult%
